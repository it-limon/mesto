(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._baseUrl=e.baseUrl,this._headers=e.headers}var n,r;return n=t,(r=[{key:"_promiseHandler",value:function(e){return e.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getUserInfo",value:function(){return this._promiseHandler(fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}))}},{key:"setUserInfo",value:function(e,t){return this._promiseHandler(fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}))}},{key:"setUserAvatar",value:function(e){return this._promiseHandler(fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}))}},{key:"getInitialCards",value:function(){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}))}},{key:"addCard",value:function(e,t){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}))}},{key:"deleteCard",value:function(e){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}))}},{key:"addLike",value:function(e){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}))}},{key:"deleteLike",value:function(e){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}))}}])&&e(n.prototype,r),t}();function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._buttonClose=this._popup.querySelector(".popup__button-close"),this._handleEscClose=this._handleEscClose.bind(this),this._handleMouseDownClose=this._handleMouseDownClose.bind(this),this.open=this.open.bind(this),this.close=this.close.bind(this),this.setEventListeners=this.setEventListeners.bind(this)}var t,n;return t=e,(n=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleMouseDownClose",value:function(e){e.target===e.currentTarget&&this.close()}},{key:"open",value:function(){document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("mousedown",this._handleMouseDownClose),this._popup.classList.add("popup_opened")}},{key:"close",value:function(){document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("mousedown",this._handleMouseDownClose),this._popup.classList.remove("popup_opened")}},{key:"setEventListeners",value:function(){this._buttonClose.addEventListener("click",this.close)}}])&&r(t.prototype,n),e}();function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?a(e):t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=l(t);if(n){var o=l(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return c(this,e)});function o(e){var t,n,i,u=e.popupSelector,c=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),f(a(i=r.call(this,u)),"_getInputValues",(function(){return i._formValues={},i._inputList.forEach((function(e){return i._formValues[e.name]=e.value})),i._formValues})),f(a(i),"setInputValues",(function(e){i._inputList.forEach((function(t,n){return t.value=e[n]}))})),f(a(i),"close",(function(){i._form.reset(),s((t=a(i),l(o.prototype)),"close",t).call(t)})),f(a(i),"renderSaving",(function(e){i._buttonSubmit.textContent=e?"Сохранение...":i._buttonSubmitDefaultText})),f(a(i),"setEventListeners",(function(){s((n=a(i),l(o.prototype)),"setEventListeners",n).call(n),i._form.addEventListener("submit",(function(e){e.preventDefault(),i._handleFormSubmit(i._getInputValues())}))})),i._form=i._popup.querySelector(".form"),i._handleFormSubmit=c,i._inputList=i._form.querySelectorAll(".form__input"),i._buttonSubmit=i._form.querySelector(".form__button-submit"),i._buttonSubmitDefaultText=i._buttonSubmit.textContent,i}return o}(o);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=y(t);if(n){var o=y(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return _(this,e)});function o(e){var t,n,i,u,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),c=function(e,r){n._img.alt=e,n._img.src=r,n._caption.textContent=e,b((t=m(n),y(o.prototype)),"open",t).call(t)},(u="open")in(i=m(n=r.call(this,e)))?Object.defineProperty(i,u,{value:c,enumerable:!0,configurable:!0,writable:!0}):i.open=c,n._img=n._popup.querySelector(".popup__image"),n._caption=n._popup.querySelector(".popup__image-caption"),n}return o}(o);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=C(t);if(n){var o=C(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return k(this,e)});function o(e){var t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),L(E(n=r.call(this,e)),"setSubmitAction",(function(e){n._handleFormSubmit=e})),L(E(n),"setEventListeners",(function(){w((t=E(n),C(o.prototype)),"setEventListeners",t).call(t),n._form.addEventListener("submit",(function(e){e.preventDefault(),n._handleFormSubmit()}))})),n._form=n._popup.querySelector(".form"),n}return o}(o);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=function e(t){var n=this,r=t.data,o=t.userId,i=t.cardSelector,u=t.handleCardClick,c=t.handleLikeClick,a=t.handleDeleteClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,"_getTemplate",(function(){return document.querySelector(n._cardSelector).content.querySelector(".cards__item").cloneNode(!0)})),I(this,"_isLiked",(function(){return n._likes.some((function(e){return e._id===n._userId}))})),I(this,"deleteCard",(function(){n._element.remove(),n._element=null})),I(this,"setLikesInfo",(function(e){n._likes=e.likes,n._likeCounter.textContent=n._likes.length,n._isLiked()?n._buttonLike.classList.add(n._buttonLikeActiveSelector):n._buttonLike.classList.remove(n._buttonLikeActiveSelector)})),I(this,"generateCard",(function(){n._element=n._getTemplate();var e=n._element.querySelector(".cards__image");e.alt=n._name,e.src=n._link,e.addEventListener("click",(function(){return n._handleCardClick(n._name,n._link)})),n._likeCounter=n._element.querySelector(".cards__like-counter"),n._likeCounter.textContent=n._likes.length,n._buttonLike=n._element.querySelector(".cards__button-like"),n._buttonLike.addEventListener("click",(function(){return n._handleLikeClick(n._id,n._isLiked())})),n._isLiked()&&n._buttonLike.classList.add(n._buttonLikeActiveSelector);var t=n._element.querySelector(".cards__button-delete");return n._ownerId===n._userId?t.addEventListener("click",(function(){return n._handleDeleteClick(n._id)})):(t.remove(),t=null),n._element.querySelector(".cards__title").textContent=n._name,n._element})),this._id=r._id,this._name=r.name,this._link=r.link,this._likes=r.likes,this._ownerId=r.owner._id,this._userId=o,this._cardSelector=i,this._handleCardClick=u,this._handleLikeClick=c,this._handleDeleteClick=a,this._buttonLikeActiveSelector="cards__button-like_active"};function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),R(this,"_hasInvalidInput",(function(){return r._inputList.some((function(e){return!e.validity.valid}))})),R(this,"_toggleButtonState",(function(){var e=r._validationSettings.inactiveButtonClass;r._hasInvalidInput()?r._buttonElement.classList.add(e):r._buttonElement.classList.remove(e)})),R(this,"_showInputError",(function(e,t){var n=r._validationSettings,o=n.inputErrorClass,i=n.errorClass;e.classList.add(o);var u=r._formElement.querySelector(".".concat(e.id,"-error"));u.classList.add(i),u.textContent=t})),R(this,"_hideInputError",(function(e){var t=r._validationSettings,n=t.inputErrorClass,o=t.errorClass;e.classList.remove(n);var i=r._formElement.querySelector(".".concat(e.id,"-error"));i.classList.remove(o),i.textContent=""})),R(this,"_checkInputValidity",(function(e){e.validity.valid?r._hideInputError(e):r._showInputError(e,e.validationMessage)})),R(this,"_setEventListeners",(function(){r._inputList.forEach((function(e){e.addEventListener("input",(function(){r._checkInputValidity(e),r._toggleButtonState()}))}))})),R(this,"enableValidation",(function(){r._formElement.addEventListener("submit",(function(e){e.preventDefault()})),r._setEventListeners()})),R(this,"resetValidation",(function(){r._inputList.forEach((function(e){r._hideInputError(e)})),r._toggleButtonState()})),this._validationSettings=t,this._formElement=n,this._inputList=Array.from(this._formElement.querySelectorAll(t.inputSelector)),this._buttonElement=this._formElement.querySelector(t.submitButtonSelector)},T={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"};function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=document.querySelector(".profile__button-add-card"),x=document.querySelector(".profile__button-edit-profile"),D=document.querySelector(".profile__button-edit-avatar"),V=new function e(t){var n=this,r=t.userNameSelector,o=t.userJobSelector,i=t.userAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"getUserInfo",(function(){return{userId:n._userId,userName:n._userName.textContent,userJob:n._userJob.textContent,userAvatar:n._userAvatar.src}})),P(this,"setUserInfo",(function(e){var t=e._id,r=e.name,o=e.about,i=e.avatar;n._userId=t,n._userName.textContent=r,n._userJob.textContent=o,n._userAvatar.src=i})),this._userName=document.querySelector(r),this._userJob=document.querySelector(o),this._userAvatar=document.querySelector(i)}({userNameSelector:".profile__name",userJobSelector:".profile__job",userAvatarSelector:".profile__avatar"}),B=function(e){var t=new j({data:e,userId:V.getUserInfo().userId,cardSelector:"#card-template",handleCardClick:function(e,t){return G.open(e,t)},handleLikeClick:function(e,n){n?N.deleteLike(e).then((function(e){return t.setLikesInfo(e)})).catch((function(e){return console.log(e)})):N.addLike(e).then((function(e){return t.setLikesInfo(e)})).catch((function(e){return console.log(e)}))},handleDeleteClick:function(e){$.setSubmitAction((function(){N.deleteCard(e).then((function(){t.deleteCard(),$.close()})).catch((function(e){return console.log(e)}))})),$.open()}});return t.generateCard()},H=new function e(t,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"addItem",(function(e){o._container.prepend(e)})),n(this,"_clear",(function(){o._container.innerHTML=""})),n(this,"renderItems",(function(e){o._clear(),e.forEach((function(e){return o._renderer(e)}))})),this._renderer=t,this._container=document.querySelector(r)}((function(e){var t=B(e);H.addItem(t)}),".cards__list"),N=new t({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-26",headers:{authorization:"367be849-b9d8-44df-8a90-129746dbd13f","Content-Type":"application/json"}}),J=[N.getUserInfo(),N.getInitialCards()];Promise.all(J).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,c=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];V.setUserInfo(o),H.renderItems(i.reverse())})).catch((function(e){return console.log(e)}));var F=new d({popupSelector:".popup-profile",handleFormSubmit:function(e){F.renderSaving(!0);var t=e["profile-name"],n=e["profile-job"];N.setUserInfo(t,n).then((function(e){V.setUserInfo(e),F.close()})).catch((function(e){return console.log(e)})).finally((function(){return F.renderSaving(!1)}))}}),M=new d({popupSelector:".popup-card",handleFormSubmit:function(e){M.renderSaving(!0);var t=e["card-name"],n=e["card-link"];N.addCard(t,n).then((function(e){var t=B(e);H.addItem(t),M.close()})).catch((function(e){return console.log(e)})).finally((function(){return M.renderSaving(!1)}))}}),z=new d({popupSelector:".popup-avatar",handleFormSubmit:function(e){z.renderSaving(!0);var t=e["avatar-link"];N.setUserAvatar(t).then((function(e){V.setUserInfo(e),z.close()})).catch((function(e){return console.log(e)})).finally((function(){return z.renderSaving(!1)}))}}),$=new O(".popup-confirm"),G=new v(".popup-image");F.setEventListeners(),M.setEventListeners(),G.setEventListeners(),z.setEventListeners(),$.setEventListeners(),x.addEventListener("click",(function(){var e=V.getUserInfo(),t=[e.userName,e.userJob];F.setInputValues(t),K.resetValidation(),F.open()})),D.addEventListener("click",(function(){W.resetValidation(),z.open()})),A.addEventListener("click",(function(){Q.resetValidation(),M.open()}));var K=new q(T,document.forms["form-profile"]),Q=new q(T,document.forms["form-card"]),W=new q(T,document.forms["form-avatar"]);K.enableValidation(),Q.enableValidation(),W.enableValidation()})();
//# sourceMappingURL=main.js.map